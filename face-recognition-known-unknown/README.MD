# ğŸ­ Face Recognition System - IOT Dashboard

Há»‡ thá»‘ng nháº­n diá»‡n khuÃ´n máº·t real-time sá»­ dá»¥ng Go Backend, React Dashboard, vÃ  MQTT Protocol.

![Dashboard Preview](https://img.shields.io/badge/Status-Active-success?style=for-the-badge)
![Go](https://img.shields.io/badge/Go-1.19+-00ADD8?style=for-the-badge&logo=go)
![React](https://img.shields.io/badge/React-18+-61DAFB?style=for-the-badge&logo=react)
![MQTT](https://img.shields.io/badge/MQTT-Protocol-660066?style=for-the-badge)

## ğŸ“‹ Má»¥c Lá»¥c
- [Tá»•ng quan](#-tá»•ng-quan)
- [TÃ­nh nÄƒng](#-tÃ­nh-nÄƒng)
- [Kiáº¿n trÃºc há»‡ thá»‘ng](#ï¸-kiáº¿n-trÃºc-há»‡-thá»‘ng)
- [YÃªu cáº§u há»‡ thá»‘ng](#-yÃªu-cáº§u-há»‡-thá»‘ng)
- [CÃ i Ä‘áº·t sau khi clone](#-cÃ i-Ä‘áº·t-sau-khi-clone)
- [Cháº¡y á»©ng dá»¥ng](#-cháº¡y-á»©ng-dá»¥ng)
- [Testing](#-testing)
- [Cáº¥u trÃºc dá»± Ã¡n](#-cáº¥u-trÃºc-dá»±-Ã¡n)
- [API Documentation](#-api-documentation)
- [Troubleshooting](#-troubleshooting)

---

## ğŸ¯ Tá»•ng quan

Há»‡ thá»‘ng giÃ¡m sÃ¡t vÃ  nháº­n diá»‡n khÃ¡ch quen/khÃ¡ch má»›i theo thá»i gian thá»±c vá»›i cÃ¡c cÃ´ng nghá»‡:

- **Backend**: Go 1.19+ vá»›i MQTT client vÃ  HTTP/WebSocket server
- **Frontend**: React 18+ vá»›i Vite, Tailwind CSS
- **Communication**: MQTT (metadata) + HTTP (images) + WebSocket (real-time)
- **Recognition**: Cosine Similarity trÃªn vector embedding 512D

## âœ¨ TÃ­nh nÄƒng

âœ… Nháº­n diá»‡n khÃ¡ch quen/má»›i real-time  
âœ… Streaming video tá»« camera  
âœ… Thá»‘ng kÃª lÆ°á»£t truy cáº­p theo thá»i gian  
âœ… LÆ°u trá»¯ vÃ  so sÃ¡nh embedding vectors (512D)  
âœ… Dashboard trá»±c quan vá»›i charts (Recharts)  
âœ… MQTT status monitoring  
âœ… WebSocket real-time updates  
âœ… Responsive design vá»›i Tailwind CSS  

---

## ğŸ—ï¸ Kiáº¿n trÃºc há»‡ thá»‘ng
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         MQTT         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESP32-CAM /    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚   Go Backend     â”‚
â”‚  Edge Device    â”‚   (metadata +        â”‚  â”œâ”€ MQTT Client  â”‚
â”‚                 â”‚    embedding)         â”‚  â”œâ”€ HTTP Server  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â””â”€ Recognition  â”‚
         â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP POST                                â”‚
         â”‚ (image)                           WebSocket
         â–¼                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â–¼
â”‚  Backend        â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /api/upload    â”‚                       â”‚  React Dashboard â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”œâ”€ VideoStream  â”‚
                                           â”‚  â”œâ”€ Recognition â”‚
                                           â”‚  â””â”€ Statistics  â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Luá»“ng hoáº¡t Ä‘á»™ng

1. **Camera/Board** capture áº£nh â†’ extract embedding 512D
2. **MQTT Publish** metadata tá»›i topic `face/metadata`
3. **HTTP POST** áº£nh gá»‘c tá»›i `/api/upload`
4. **Backend** nháº­n MQTT message â†’ so sÃ¡nh database â†’ xÃ¡c Ä‘á»‹nh khÃ¡ch quen/má»›i
5. **WebSocket** broadcast káº¿t quáº£ real-time
6. **Dashboard** hiá»ƒn thá»‹ káº¿t quáº£

---

## ğŸ’» YÃªu cáº§u há»‡ thá»‘ng

### Báº¯t buá»™c

| CÃ´ng cá»¥ | Version | Download |
|---------|---------|----------|
| **Go** | >= 1.19 | [golang.org/dl](https://golang.org/dl/) |
| **Node.js** | >= 18.x | [nodejs.org](https://nodejs.org/) |
| **npm** | >= 9.x | (Ä‘i kÃ¨m Node.js) |
| **Git** | Latest | [git-scm.com](https://git-scm.com/) |

### Optional (cho testing)

| CÃ´ng cá»¥ | Version | Má»¥c Ä‘Ã­ch |
|---------|---------|----------|
| **Python** | >= 3.8 | MQTT test script |
| **pip** | Latest | Python packages |

### MQTT Broker

Dá»± Ã¡n máº·c Ä‘á»‹nh sá»­ dá»¥ng public broker: **`test.mosquitto.org:1883`**

KhÃ´ng cáº§n cÃ i Ä‘áº·t local broker trá»« khi muá»‘n tá»± host.

---

## ğŸš€ CÃ i Ä‘áº·t sau khi clone

### BÆ°á»›c 1: Clone Repository
```bash
git clone https://github.com/your-username/face-recognition-system.git
cd face-recognition-system
```

### BÆ°á»›c 2: CÃ i Ä‘áº·t Backend (Go)
```bash
cd backend

# Táº£i dependencies
go mod download

# Hoáº·c
go mod tidy

# Verify dependencies
go mod verify
```

**Dependencies sáº½ Ä‘Æ°á»£c cÃ i:**
- `github.com/eclipse/paho.mqtt.golang` - MQTT client
- `github.com/gorilla/mux` - HTTP router
- `github.com/gorilla/websocket` - WebSocket
- `github.com/rs/cors` - CORS middleware

### BÆ°á»›c 3: CÃ i Ä‘áº·t Dashboard (React)
```bash
cd ../dashboard

# CÃ i táº¥t cáº£ dependencies
npm install

# Hoáº·c dÃ¹ng yarn
yarn install
```

**Dependencies chÃ­nh:**
- React 18+
- Vite (build tool)
- Tailwind CSS
- Recharts (charts)
- Lucide React (icons)

### BÆ°á»›c 4: CÃ i Ä‘áº·t Python (Optional - cho testing)
```bash
# Quay vá» thÆ° má»¥c gá»‘c
cd ..

# Táº¡o virtual environment (recommended)
python -m venv venv

# Activate
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# CÃ i paho-mqtt
pip install paho-mqtt
```

---

## ğŸ® Cháº¡y á»©ng dá»¥ng

### Cháº¡y Ä‘áº§y Ä‘á»§ há»‡ thá»‘ng (3 terminals)

#### Terminal 1: Backend
```bash
cd backend
go run cmd/server/main.go
```

**Output thÃ nh cÃ´ng:**
```
Connected to MQTT broker
Server starting on :8080
```

Backend sáº½ cháº¡y táº¡i: **http://localhost:8080**

#### Terminal 2: Dashboard
```bash
cd dashboard
npm run dev
```

**Output thÃ nh cÃ´ng:**
```
VITE v5.x.x  ready in xxx ms

âœ  Local:   http://localhost:5173/
âœ  Network: use --host to expose
```

Dashboard sáº½ cháº¡y táº¡i: **http://localhost:5173**

#### Terminal 3: MQTT Test (Optional)
```bash
python test_mqtt_sender.py
```

Chá»n option:
- `1` - Gá»­i 1 detection test
- `2` - Gá»­i liÃªn tá»¥c má»—i 5 giÃ¢y â­ **Recommended cho testing**
- `3` - Gá»­i liÃªn tá»¥c má»—i 10 giÃ¢y
- `4` - Gá»­i burst 10 detections

### Truy cáº­p Dashboard

Má»Ÿ trÃ¬nh duyá»‡t: **http://localhost:5173**

Báº¡n sáº½ tháº¥y:
- âœ… WebSocket Connected (gÃ³c pháº£i trÃªn)
- â³ MQTT Idle (chá» message)

Khi cháº¡y test script (Terminal 3):
- âœ… MQTT Active vá»›i sá»‘ message Ä‘áº¿m
- ğŸ”” Toast notification xuáº¥t hiá»‡n
- ğŸ“Š Recognition panel cáº­p nháº­t real-time

---

## ğŸ§ª Testing

### 1. Test MQTT Connection
```bash
python test_mqtt_sender.py
```

Chá»n option `2` Ä‘á»ƒ gá»­i liÃªn tá»¥c.

**Káº¿t quáº£ mong Ä‘á»£i:**
- Backend logs: `ğŸ“© MQTT Message Received`
- Dashboard: MQTT status chuyá»ƒn sang "Active"
- Toast notification xuáº¥t hiá»‡n
- Recognition panel cáº­p nháº­t

### 2. Test API Endpoints

#### Get Stats
```bash
curl http://localhost:8080/api/stats
```

Response:
```json
{
  "total_people": 5,
  "total_visits": 42,
  "known_visitors": 3,
  "new_visitors": 2
}
```

#### Get Visitors
```bash
curl http://localhost:8080/api/visitors
```

#### Upload Image
```bash
curl -X POST -F "image=@test.jpg" http://localhost:8080/api/upload
```

### 3. Test WebSocket

Má»Ÿ DevTools Console trong browser:
```javascript
const ws = new WebSocket('ws://localhost:8080/ws');
ws.onmessage = (e) => console.log('Received:', JSON.parse(e.data));
```

Cháº¡y test script Ä‘á»ƒ xem message real-time.

---

## ğŸ“ Cáº¥u trÃºc dá»± Ã¡n
```
face-recognition-system/
â”‚
â”œâ”€â”€ backend/                      # Go Backend
â”‚   â”œâ”€â”€ cmd/
â”‚   â”‚   â””â”€â”€ server/
â”‚   â”‚       â””â”€â”€ main.go          # Entry point
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ models/              # Data structures
â”‚   â”‚   â”œâ”€â”€ mqtt/                # MQTT client & handlers
â”‚   â”‚   â”œâ”€â”€ http/                # HTTP server & API
â”‚   â”‚   â””â”€â”€ recognition/         # Cosine similarity & database
â”‚   â”œâ”€â”€ uploads/                 # Uploaded images (gitignored)
â”‚   â”œâ”€â”€ data/                    # Database files (gitignored)
â”‚   â”œâ”€â”€ go.mod
â”‚   â””â”€â”€ go.sum
â”‚
â”œâ”€â”€ dashboard/                    # React Dashboard
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/          # React components
â”‚   â”‚   â”‚   â”œâ”€â”€ VideoStream.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RecognitionPanel.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ VisitorStats.jsx
â”‚   â”‚   â”‚   â””â”€â”€ VisitorHistory.jsx
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.js          # HTTP API
â”‚   â”‚   â”‚   â””â”€â”€ websocket.js    # WebSocket
â”‚   â”‚   â”œâ”€â”€ App.jsx
â”‚   â”‚   â”œâ”€â”€ main.jsx
â”‚   â”‚   â””â”€â”€ index.css
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â””â”€â”€ tailwind.config.js
â”‚
â”œâ”€â”€ test_mqtt_sender.py          # MQTT test script
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## ğŸ“¡ API Documentation

### Base URL
```
http://localhost:8080
```

### Endpoints

#### 1. Upload Image
```http
POST /api/upload
Content-Type: multipart/form-data

Body:
  image: <file>

Response:
{
  "message": "Upload successful",
  "path": "image_name.jpg"
}
```

#### 2. Get Statistics
```http
GET /api/stats

Response:
{
  "total_people": 10,
  "total_visits": 150,
  "known_visitors": 7,
  "new_visitors": 3
}
```

#### 3. Get Visitors List
```http
GET /api/visitors

Response:
[
  {
    "id": "person_123",
    "name": "John Doe",
    "visit_count": 5,
    "last_seen": "2025-10-31T10:30:00Z",
    "embeddings": [[...512 floats...]]
  }
]
```

#### 4. WebSocket
```
ws://localhost:8080/ws
```

**Message format:**
```json
{
  "person_id": "person_123",
  "name": "John Doe",
  "is_known": true,
  "confidence": 0.85,
  "timestamp": "2025-10-31T10:30:00Z",
  "image_url": "/uploads/image.jpg",
  "visit_count": 5
}
```

### MQTT Topics

#### Subscribe (Backend)
```
Topic: face/metadata

Payload:
{
  "person_id": "person_123",
  "timestamp": "2025-10-31T10:30:00Z",
  "embedding": [512 floats],
  "image_path": "image.jpg",
  "camera_id": "CAM-001"
}
```

---

## ğŸ”§ Troubleshooting

### Backend khÃ´ng start Ä‘Æ°á»£c

**Lá»—i: "port 8080 already in use"**
```bash
# Windows
netstat -ano | findstr :8080
taskkill /PID <PID> /F

# Linux/Mac
lsof -ti:8080 | xargs kill -9
```

**Lá»—i: "cannot connect to MQTT broker"**
- Kiá»ƒm tra internet connection
- Thá»­ broker khÃ¡c: `tcp://broker.hivemq.com:1883`
- Trong `cmd/server/main.go`, Ä‘á»•i broker URL

### Dashboard khÃ´ng káº¿t ná»‘i WebSocket

**Lá»—i: "WebSocket connection failed"**
1. Kiá»ƒm tra backend Ä‘ang cháº¡y
2. Kiá»ƒm tra URL trong `services/websocket.js`
3. Disable browser extensions (AdBlock, etc.)

### MQTT test script lá»—i

**Lá»—i: "ModuleNotFoundError: No module named 'paho'"**
```bash
pip install paho-mqtt
```

**Lá»—i: "Connection refused"**
- Kiá»ƒm tra broker URL
- Thá»­ broker public khÃ¡c
- Kiá»ƒm tra firewall

### Dashboard khÃ´ng hiá»ƒn thá»‹ Ä‘Ãºng

**Lá»—i: Tailwind classes khÃ´ng work**
```bash
cd dashboard
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
npm run dev
```

### Upload áº£nh lá»—i

**Lá»—i: "413 Payload Too Large"**
- Giáº£m kÃ­ch thÆ°á»›c áº£nh
- Trong backend, tÄƒng limit: `r.ParseMultipartForm(50 << 20)` // 50MB

---

## ğŸ› ï¸ Configuration

### Backend Environment Variables

Táº¡o file `backend/.env` (optional):
```env
PORT=8080
MQTT_BROKER=tcp://test.mosquitto.org:1883
MQTT_TOPIC=face/metadata
DATABASE_PATH=./data/faces.json
UPLOAD_DIR=./uploads
```

### Dashboard Environment Variables

Táº¡o file `dashboard/.env` (optional):
```env
VITE_API_URL=http://localhost:8080
VITE_WS_URL=ws://localhost:8080/ws
```

---

## ğŸ“ Development

### Build cho production

#### Backend
```bash
cd backend
go build -o face-recognition-server cmd/server/main.go

# Windows
go build -o face-recognition-server.exe cmd/server/main.go
```

#### Dashboard
```bash
cd dashboard
npm run build
# Output trong folder 'dist/'
```

### Deploy

1. **Backend**: Upload binary + `uploads/` + `data/`
2. **Dashboard**: Upload `dist/` folder
3. Cáº¥u hÃ¬nh reverse proxy (Nginx/Caddy)
4. Setup MQTT broker riÃªng (optional)

---

## ğŸ‘¥ Contributing

1. Fork the project
2. Create feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. Open Pull Request

---

## ğŸ“„ License

This project is licensed under the MIT License.

---

## ğŸ“§ Contact

Project Link: [https://github.com/your-username/face-recognition-system](https://github.com/your-username/face-recognition-system)

---

## ğŸ™ Acknowledgments

- [Paho MQTT](https://www.eclipse.org/paho/)
- [Gorilla WebSocket](https://github.com/gorilla/websocket)
- [React](https://react.dev/)
- [Tailwind CSS](https://tailwindcss.com/)
- [Recharts](https://recharts.org/)
- [Lucide Icons](https://lucide.dev/)

---

**Made with â¤ï¸ for IOT Course - UIT**